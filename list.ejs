<%- include('../partials/header') %>


<div class="d-flex justify-content-between align-items-center mb-3">
    <h1>Customer List</h1>
    <a href="/customers/add" class="btn btn-success">Add Customer</a>
</div>

<!-- SEARCH FORM -->
<form class="mb-3" method="GET" action="/customers">
  <div class="input-group" style="max-width:480px;">
    <input type="text" name="search" class="form-control" placeholder="Search by name, email, phone, address, or sales..." value="<%= typeof search !== 'undefined' ? search : '' %>">
    <button class="btn btn-outline-secondary" type="submit">Search</button>
  </div>
</form>

<table class="table table-striped table-hover align-middle">
  <thead>
    <tr>
      <!-- <th>ID</th> -->
      <th>Name</th>
      <th>Contact</th>
      <th>Address</th>
      <th>Email</th>
      <th>Phone</th>
      <th>Sales</th>
      <th>Description</th>
      <th>Actions</th>
    </tr>
  </thead>

  <tbody>
    <% customers.forEach(c => { %>
      <tr>
        <!-- <td><%= c.id %></td> -->
        <td><%= c.name %></td>
        <td><%= c.contact || '-' %></td>
        <td><%= c.address %></td>
        <td><%= c.email %></td>
        <td><%= c.phone %></td>
        <td><%= c.sales ? c.sales.username : '-' %></td>
        <td><%= c.description %></td>

        <td>
          <a href="/customers/edit/<%= c.id %>" class="btn btn-warning btn-sm">Edit</a>
          <form action="/customers/delete/<%= c.id %>?_method=DELETE" method="POST" style="display:inline;">
            <button class="btn btn-danger btn-sm">Delete</button>
          </form>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>

<!-- PAGINATION -->
<nav aria-label="Page navigation">
    <ul class="pagination">

        <% if (currentPage > 1) { %>
            <li class="page-item">
              <a class="page-link" href="/customers?page=<%= currentPage - 1 %><% if (search) { %>&search=<%= encodeURIComponent(search) %><% } %>">Previous</a>
            </li>
        <% } else { %>
            <li class="page-item disabled">
                <span class="page-link">Previous</span>
            </li>
        <% } %>

        <% for (let i = 1; i <= totalPages; i++) { %>
          <li class="page-item <%= currentPage === i ? 'active' : '' %>">
            <a class="page-link" href="/customers?page=<%= i %><% if (search) { %>&search=<%= encodeURIComponent(search) %><% } %>"><%= i %></a>
          </li>
        <% } %>

        <% if (currentPage < totalPages) { %>
          <li class="page-item">
            <a class="page-link" href="/customers?page=<%= currentPage + 1 %><% if (search) { %>&search=<%= encodeURIComponent(search) %><% } %>">Next</a>
          </li>
        <% } else { %>
            <li class="page-item disabled">
                <span class="page-link">Next</span>
            </li>
        <% } %>

    </ul>
</nav>

<%- include('../partials/footer') %>
