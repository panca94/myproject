<%- include('../partials/header') %>

<h3>Add Project</h3>

<form action="/projects/add" method="POST">
    <div class="mb-3">
        <label for="projectName" class="form-label">Project Name</label>
        <input type="text" class="form-control" id="projectName" name="projectName" required>
    </div>
    
    <div class="mb-3">
        <label for="customerId" class="form-label">Customer</label>
        <select class="form-select select2" id="customerId" name="customerId" required>
            <option value="">-- Select Customer --</option>
            <% customers.forEach(customer => { %>
                <option value="<%= customer.id %>"><%= customer.name %></option>
            <% }) %>
        </select>
        <% if (customers.length === 0) { %>
            <div class="text-danger small mt-1">Tidak ada customer yang ter-assign pada Anda. Hubungi admin untuk penugasan.</div>
        <% } %>
    </div>

    <!-- Logic untuk menampilkan pilihan Account Manager berdasarkan role -->
    <% if (user.role === 'sales') { %>
        <!-- Jika Sales, sembunyikan input dan kirim ID user secara tersembunyi -->
        <input type="hidden" name="userId" value="<%= user.id %>">
        <div class="mb-3">
            <label for="userId" class="form-label">Account Manager</label>
            <input type="text" class="form-control" value="<%= user.username %>" readonly>
        </div>
    <% } else { %>
        <!-- Jika Admin atau Manager, tampilkan dropdown untuk memilih Account Manager -->
        <div class="mb-3">
            <label for="userId" class="form-label">Account Manager</label>
            <select class="form-select" id="userId" name="userId" required>
                <option value="">-- Pilih Account Manager --</option>
                <% users.forEach(user_item => { %>
                    <option value="<%= user_item.id %>"><%= user_item.username %></option>
                <% }) %>
            </select>
        </div>
    <% } %>

    <div class="mb-3">
        <label for="amount" class="form-label">Project Value (Rp)</label>
        <input type="number" class="form-control" id="amount" name="amount">
    </div>
    
    <div class="mb-3">
        <label for="projectDate" class="form-label">Project Date</label>
        <input type="date" class="form-control" id="projectDate" name="projectDate">
    </div>
    
    <div class="mb-3">
        <label for="status" class="form-label">Status</label>
        <select class="form-select" id="status" name="status">
            <option value="Budgeting">Budgeting</option>
            <option value="On Progress" selected>On Progress</option>
            <option value="Won">Won</option>
            <option value="Lost">Lost</option>
            <option value="Re-Tender">Re-Tender</option>
        </select>
    </div>

    <div class="mb-3">
        <label for="update_status" class="form-label">Update</label>
        <select class="form-select" id="update_status" name="update_status">
            <option value="">-- Select Update Status --</option>
            <option value="Proposal Submit">Proposal Submit</option>
            <option value="Eng Calculate">Eng Calculate</option>
            <option value="Won">Won</option>
        </select>
    </div>

    <div class="mb-3">
        <label for="challenge" class="form-label">Challenge</label>
        <textarea class="form-control" id="challenge" name="challenge" rows="3"></textarea>
    </div>

    <button type="submit" class="btn btn-success">Save</button>
    <a href="/projects" class="btn btn-secondary">Cancel</a>
</form>

<%- include('../partials/footer') %>